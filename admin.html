<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin Panel</title>
  <style>
    /* Add basic styles or link your main CSS here */
    .show { display: block; }
    .hidden { display: none; }
    table, td, th { border: 1px solid #aaa; border-collapse: collapse; padding: 8px; }
    .online { color: green; }
    .offline { color: red; }
  </style>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";
    import { getFirestore } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";
    import { getStorage } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-storage.js";

    const firebaseConfig = {
      apiKey: "AIzaSyA4xfUevmevaMDxK2_gLgvZUoqm0gmCn_k",
      authDomain: "store-7b9bd.firebaseapp.com",
      projectId: "store-7b9bd",
      storageBucket: "store-7b9bd.firebasestorage.app",
      messagingSenderId: "1015427798898",
      appId: "1:1015427798898:web:a15c71636506fac128afeb",
      measurementId: "G-NR4JS3FLWG"
    };

    const allowedUID = "thisLigBezoWV9eVo8lglsijoWinKmA2";
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const storage = getStorage(app);

    onAuthStateChanged(auth, async (user) => {
      if (user && user.uid === allowedUID) {
        // Dynamically load the admin panel script
        const module = await import("./admin.js");
        module.initAdminPanel(db, auth, storage, user.uid, true);
      } else {
        alert("Unauthorized or not signed in.");
        window.location.href = "/";
      }
    });
  </script>
</head>
<body>
  <h1>Admin Panel</h1>

  <!-- Admin Panel Modal -->
  <div id="admin-panel-modal" class="show">
    <button id="close-admin-panel-modal">Close</button>

    <!-- Tabs -->
    <div>
      <button class="admin-tab-btn" data-tab="products">ðŸ›’ Products</button>
      <button class="admin-tab-btn" data-tab="orders">ðŸ“¦ Orders</button>
      <button class="admin-tab-btn" data-tab="seller-status">ðŸ”Œ Seller Status</button>
    </div>

    <!-- Product Management Tab -->
    <div id="admin-product-management">
      <h2 id="product-form-title">Add New Product</h2>
      <input id="product-id-input" type="hidden" />
      <input id="product-name" placeholder="Product Name" />
      <select id="product-category">
        <option value="pets">Pets</option>
        <option value="gamepasses">Gamepasses</option>
      </select>
      <input id="product-price" type="number" placeholder="Price" />
      <input id="product-sale-price" type="number" placeholder="Sale Price" />
      <input id="product-stock" type="number" placeholder="Stock" />
      <input id="product-image" placeholder="Image filename" />
      <label><input id="product-new" type="checkbox" /> New</label>
      <label><input id="product-sale" type="checkbox" /> Sale</label>
      <button id="save-product-btn">Add Product</button>
      <button id="cancel-edit-product" style="display:none;">Cancel</button>

      <table>
        <thead>
          <tr><th>Image</th><th>Name</th><th>Category</th><th>Price</th><th>Stock</th><th>Status</th><th>Actions</th></tr>
        </thead>
        <tbody id="admin-products-list"></tbody>
      </table>
    </div>

    <!-- Order Management Tab -->
    <div id="admin-order-management" class="hidden">
      <table>
        <thead>
          <tr><th>Order ID</th><th>User ID</th><th>Date</th><th>Total</th><th>Status</th><th>Actions</th></tr>
        </thead>
        <tbody id="admin-orders-list"></tbody>
      </table>

      <div id="admin-order-details-view" style="display:none;">
        <h3>Order Details</h3>
        <p>ID: <span id="admin-detail-order-id"></span></p>
        <p>User ID: <span id="admin-detail-user-id"></span></p>
        <p>Roblox Username: <span id="admin-detail-roblox-username"></span></p>
        <p>Date: <span id="admin-detail-order-date"></span></p>
        <p>Total: <span id="admin-detail-order-price"></span></p>
        <p>Payment Method: <span id="admin-detail-payment-method"></span></p>
        <p>Status: <span id="admin-detail-order-status"></span></p>
        <select id="order-status-select">
          <option>Pending</option>
          <option>Processing</option>
          <option>Completed</option>
          <option>Cancelled</option>
        </select>
        <button id="update-order-status-btn">Update Status</button>
        <button id="admin-back-to-order-list">Back to Orders</button>
        <div id="admin-detail-items-list"></div>
      </div>
    </div>

    <!-- Seller Status Tab -->
    <div id="admin-seller-status" class="hidden">
      <h2>Seller Status: <span id="admin-seller-status-display" class="offline">Offline</span></h2>
      <button id="toggle-seller-status-btn">Toggle</button>
    </div>
  </div>
</body>
</html>

